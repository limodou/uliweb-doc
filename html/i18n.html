

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>I18N 使用说明 &mdash; Uliweb Documentation 0.1.4 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="top" title="Uliweb Documentation 0.1.4 documentation" href="index.html" />
    <link rel="next" title="Mail 处理" href="mail.html" />
    <link rel="prev" title="Settings说明" href="settings.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="mail.html" title="Mail 处理"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="settings.html" title="Settings说明"
             accesskey="P">上一页</a> |</li>
        <li><a href="index.html">Uliweb Documentation 0.1.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="i18n">
<h1>I18N 使用说明<a class="headerlink" href="#i18n" title="永久链接至标题">¶</a></h1>
<p>Uliweb支持标准的gettext的i18n的处理。在程序中和在模板中都可以使用，甚至在ini文件
中也可以使用。</p>
<div class="section" id="id1">
<h2>I18N的配置<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>为了使用i18n，需要在settings.ini中的INSTALLED_APPS中添加 <tt class="docutils literal"><span class="pre">'uliweb.contrib.i18n'</span></tt> ，
同时uliweb.contrib.i18n下的settings.ini还定义了一些配置项，如:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">I18N</span><span class="p">]</span>
<span class="n">LANGUAGE_COOKIE_NAME</span> <span class="o">=</span> <span class="s">&#39;uliweb_language&#39;</span>
<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s">&#39;en&#39;</span>
<span class="n">LOCALE_DIRS</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">SUPPORT_LANGUAGES</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">LANGUAGE_COOKIE_NAME</span></tt> 是用来将语言的选择存在cookie中使用的，一般不需要修改。</li>
<li><tt class="docutils literal"><span class="pre">LANGUAGE_CODE</span></tt> 是表示缺省的语言，缺省为英文。</li>
<li><tt class="docutils literal"><span class="pre">LOCALE_DIRS</span></tt> 可以用来设置语言文件所在的目录，可以是多个。同时在其中还可以定
义一些特殊的变量，如: <tt class="docutils literal"><span class="pre">${PROJECT}</span></tt> 表示项目目录， <tt class="docutils literal"><span class="pre">${plugs}</span></tt> 表示plugs模块所在的目录。
所以通过这些变量可以引用一些与项目有关的相对路径。</li>
<li><tt class="docutils literal"><span class="pre">SUPPORT_LANGUAGES</span></tt> 表示网站所支持的语言种类。除原本开发所使用的语言外，如果浏
览器自动希望某种语言，并且这种语言在 <tt class="docutils literal"><span class="pre">SUPPORT_LANGUAGES</span></tt> 所支持的范围之内时，才会
生效。</li>
</ul>
<p>一旦配置了I18N，则会自动应用 <tt class="docutils literal"><span class="pre">'uliweb.i18n.middle_i18n.I18nMiddle'</span></tt> 这个middleware，
这个可以在uliweb.contrib.i18n/settings.ini中看到。</p>
</div>
<div class="section" id="id2">
<h2>I18N语言的判定规则<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>在Uliweb中，可以有许多种方式来决定使用哪种语言，比如：在session中，在cookie中，
通过浏览器发送的HTTP头来自动判断，还有就是在settings中的 <tt class="docutils literal"><span class="pre">LANGUAGE_CODE</span></tt> 来决定。
Uliweb在处理时按照以下的顺序来决定是否使用某种语言:</p>
<ol class="arabic">
<li><p class="first">如果url的Query_String上有 <tt class="docutils literal"><span class="pre">lang=xxx</span></tt> 的信息，则这个值为要使用的语言。 (<cite>0.0.1増加</cite>)</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p><tt class="docutils literal"><span class="pre">lang</span></tt> 的名字是可以在settings.ini中配置的，缺省为空，需要设置此功能才会启动。
配置选项如下:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">I18N</span><span class="p">]</span>
<span class="n">URL_LANG_KEY</span> <span class="o">=</span> <span class="s">&#39;lang&#39;</span>
</pre></div>
</div>
</div>
</li>
<li><p class="first">如果session中存在 uliweb_language 的定义，则这个值为要使用的语言；</p>
</li>
<li><p class="first">如果cookie中存在与settings.ini中 <tt class="docutils literal"><span class="pre">I18N/LANGUAGE_COOKIE_NAME</span></tt> 对应的值时，则这个
值为要使用的语言；</p>
</li>
<li><p class="first">如果浏览器发送的HTTP头有 <tt class="docutils literal"><span class="pre">HTTP_ACCEPT_LANGUAGE</span></tt> 的信息，并且得到的语言在
<tt class="docutils literal"><span class="pre">SUPPORT_LANGUAGES</span></tt> 中有定义，则使用HTTP头中定义的语言；</p>
</li>
<li><p class="first">最后选择settings.ini中定义的 <tt class="docutils literal"><span class="pre">LANGUAGE_CODE</span></tt></p>
</li>
</ol>
<p>所以如果你的网站支持多种语言，可以按照上面的说明来选择不同的模式。简单情况下只
要定义 <tt class="docutils literal"><span class="pre">LANGUAGE_CODE='zh_CN'</span></tt> 就可以支持中文了。如果想支持浏览器自动识别，可以定义
settings.ini为:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">I18N</span><span class="p">]</span>
<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s">&#39;en&#39;</span>
<span class="n">SUPPORT_LANGUAGES</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;en&#39;</span><span class="p">,</span> <span class="s">&#39;zh_CN&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>上面的定义说明当前网站支持两种语言，缺省为 <tt class="docutils literal"><span class="pre">'en'</span></tt> 。</p>
</div>
<div class="section" id="id3">
<h2>I18N字符串的定义<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>为了使用i18n，首先要在程序中进行i18n的定义，根据文件格式的不同，使用略有不同。</p>
<div class="section" id="id4">
<h3>程序文件<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<p>这里是指.py文件。示例如下:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">uliweb.orm</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">uliweb.i18n</span> <span class="kn">import</span> <span class="n">ugettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Username&#39;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Email&#39;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&#39;Password&#39;</span><span class="p">),</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>在uliweb.i18n中定义了几组gettext函数，常用的就是gettext, ugettext, gettext_lazy
和ugettext_lazy。带u的表示返回为unicode字符串，否则为字符串。后缀有lazy的表示
在运行时会根据当时的上下文环境自动进行语言的切换。因此一般使用带有lazy的函数。</p>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">使用lazy的函数不能支持 <tt class="docutils literal"><span class="pre">_('%s')</span> <span class="pre">%</span> <span class="pre">'name'</span></tt> 这种形式，所以建议使用非lazy的函数</p>
</div>
</div>
<div class="section" id="id5">
<h3>模板<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<p>因为uliweb的模板会编译为.py文件，所以除了不用导入gettext函数外，和在程序中无差别。
一旦你配置了i18n的app，会自动向模板环境中添加 <tt class="docutils literal"><span class="pre">_()</span></tt> 函数。示例:</p>
<div class="highlight-python"><pre>&lt;div&gt;hi, {{=_('name')}}&lt;/div&gt;</pre>
</div>
<p>所以要编辑的串，都要放在 <tt class="docutils literal"><span class="pre">{{}}</span></tt> 中，并且使用 <tt class="docutils literal"><span class="pre">_()</span></tt> 进行处理。</p>
<div class="admonition attention">
<p class="first admonition-title">注意</p>
<p class="last">在模板中 <tt class="docutils literal"><span class="pre">_()</span></tt> 中的字符串不要使用 <tt class="docutils literal"><span class="pre">u''</span></tt> 的形式，并且整个模板以utf-8来保存。</p>
</div>
</div>
<div class="section" id="settings-ini">
<h3>settings.ini<a class="headerlink" href="#settings-ini" title="永久链接至标题">¶</a></h3>
<p>在settings.ini中也可以使用翻译函数，如:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">DEFAULT</span><span class="p">]</span>
<span class="n">NAME</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h2>I18N字符串的提取<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>uliweb.contrib.i18n App提供了一个i18n的命令它提供以下参数:</p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--apps</span></kbd></td>
<td>如果设置，将从存在于项目中的所有app中进行抽取，并将 .po 文件保存在每个app下的 <tt class="docutils literal"><span class="pre">locale</span></tt> 目录中。</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-p</span></kbd></td>
<td>如果设置，将从项目目录抽取翻译信息。</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-d <var>DIRECTORY</var></span></kbd></td>
<td>如果设置，将从指定目录抽取翻译信息。</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--uliweb</span></kbd></td>
<td>如果设置，将从uliweb包中抽取翻译信息。</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-l <var>LOCALE</var></span></kbd></td>
<td>目标语言，缺省是 <tt class="docutils literal"><span class="pre">en</span></tt> 。</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--exact</span></kbd></td>
<td>如果设置，则在旧的.po中存在，但是在.pot中不存在的项目将被删除。 (<cite>0.0.1新増</cite>)</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">-t <var>TEMPLATE</var></span>, <span class="option">--template=<var>TEMPLATE</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>PO文件中一些静态信息的定义，如：charset, translater等模板的定义。</td></tr>
</tbody>
</table>
<p>因此i18n支持几种语言提取方式:</p>
<ol class="arabic">
<li><p class="first"><tt class="docutils literal"><span class="pre">--apps</span></tt> 这种方式会在每个app下都生成一个locale的目录。注意这种方式只处理存在于项目目录下的app，对于已经安装但是不存在于项目目录下的app将不做处理。</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">-p</span></tt> 这种方式会将项目下创建一个locale目录，将整个项目所有的内容都放在一个文件中</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">-d</span></tt> 按指定目录进行处理。比如plugs它只是一个app的集合，并不是一个完整的项目，所以
上述参数无法使用，但是可以使用这个-d参数进行处理</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">--uliweb</span></tt> 对uliweb本身进行处理。因为uliweb中有些文件中也有i18n的翻译串，所以
可以使用这个命令来处理</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">-t</span></tt> 它允许你写一个po的模板文件，在uliweb.i18n下已经提供了一个示例，名为: <tt class="docutils literal"><span class="pre">po_template.ini</span></tt>
其内容为:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">I18N</span><span class="p">]</span>
<span class="n">First_Author</span> <span class="o">=</span> <span class="s">&#39;FIRST AUTHOR &lt;EMAIL@ADDRESS&gt;&#39;</span>
<span class="n">Project_Id_Version</span> <span class="o">=</span> <span class="s">&#39;PACKAGE VERSION&#39;</span>
<span class="n">Last_Translator</span> <span class="o">=</span> <span class="s">&#39;FULL NAME &lt;EMAIL@ADDRESS&gt;&#39;</span>
<span class="n">Language_Team</span> <span class="o">=</span> <span class="s">&#39;LANGUAGE &lt;LL@li.org&gt;&#39;</span>
<span class="n">Content_Type_Charset</span> <span class="o">=</span> <span class="s">&#39;utf-8&#39;</span>
<span class="n">Content_Transfer_Encoding</span> <span class="o">=</span> <span class="s">&#39;8bit&#39;</span>
<span class="n">Plural_Forms</span> <span class="o">=</span> <span class="s">&#39;nplurals=1; plural=0;&#39;</span>
</pre></div>
</div>
<p>你可以修改其中的内容，它们将自动填充到生成的pot和po文件中。</p>
</li>
</ol>
<p>使用示例:</p>
<div class="highlight-python"><pre>uliweb i18n -p -l zh_CN</pre>
</div>
<p>注意， <tt class="docutils literal"><span class="pre">-l</span></tt> 参数如果不提供则自动为 <tt class="docutils literal"><span class="pre">'en'</span></tt> 。因此，如果要翻译中文一定要加上 <tt class="docutils literal"><span class="pre">-l</span> <span class="pre">zh_CN</span></tt> 。</p>
</div>
<div class="section" id="id7">
<h2>编码注意事项<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<p>在i18n中提供gettext和ugettext，它们的区别是：前者返回字符串，后者返回unicode。
为了正确处理中文编码，建议：程序、模板包括ini文件都使用utf-8编码来处理。</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">內容目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">I18N 使用说明</a><ul>
<li><a class="reference internal" href="#id1">I18N的配置</a></li>
<li><a class="reference internal" href="#id2">I18N语言的判定规则</a></li>
<li><a class="reference internal" href="#id3">I18N字符串的定义</a><ul>
<li><a class="reference internal" href="#id4">程序文件</a></li>
<li><a class="reference internal" href="#id5">模板</a></li>
<li><a class="reference internal" href="#settings-ini">settings.ini</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6">I18N字符串的提取</a></li>
<li><a class="reference internal" href="#id7">编码注意事项</a></li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="settings.html"
                        title="上一章">Settings说明</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="mail.html"
                        title="下一章">Mail 处理</a></p>
  <h3>本页</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/i18n.txt"
           rel="nofollow">显示源代码</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>快速搜索</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="搜索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    输入相关的模块，术语，类或者函数名称进行搜索
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="mail.html" title="Mail 处理"
             >下一页</a> |</li>
        <li class="right" >
          <a href="settings.html" title="Settings说明"
             >上一页</a> |</li>
        <li><a href="index.html">Uliweb Documentation 0.1.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; 版权所有 2012, limodou.
      使用 <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>